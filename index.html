<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
    <link href="https://fonts.googleapis.com/css?family=Noto+Serif+JP:600&display=swap" rel="stylesheet">
<style>
    p{font-family:'Noto Serif JP',serif;}
    body{font-family:'Noto Serif JP',serif;}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>東方ニコ楽祭_poem_tukimi</title>
</head>
<font size="4">

<script type="text/javascript">

var urlParam = location.search.substring(1);
 
var utaCount = 0;
var array = loadFile();

// URLにパラメータが存在する場合
if(urlParam) {
    // 「&」が含まれている場合は「&」で分割
    var param = urlParam.split('&');
    var userFlg = 0;    //ユーザ指定のときは1にする
    var illustFlg = 0;  //イラスト指定(im番号)のときは1にする

    var printedIllust = "im"; //前回表示したイラストのim番号

    var paramArray = [];    //パラメータ格納用の配列

    //配列にパラメータを格納

    for (i = 0; i < param.length; i++) {
        var paramItem = param[i].split('=');
        paramArray[paramItem[0]] = paramItem[1];
        if(paramItem[0]=="user"){
            userFlg = 1;
        }else if(paramItem[0]=="illust"){
            illustFlg = 1;
        }
    }
    if(userFlg==1){
        var userName = paramArray.user;
        userName = decodeURI(userName);
        document.write("<p>詠み手指定：" + userName +"</p>");
    }

    if(illustFlg==1){
        document.write("<p>静画ID指定：" + paramArray.illust +"</p>");
    }

    for(i=0; i<utaCount; i++){
        if((userFlg == 0 || array[i][4].trim() == userName) && (illustFlg == 0 || array[i][0] == paramArray.illust)){
            if(array[i][0] != printedIllust){   //前に表示したイラストと異なる場合のみイラスト情報を表示する。
                imgiframe = "<iframe width='312' height=\"176\" src=\"https://ext.seiga.nicovideo.jp/thumb/"+ array[i][0] +"\" scrolling=\"no\" style=\"border:solid 1px #888;\" frameborder=\"0\"><a href=\"https://seiga.nicovideo.jp/seiga/"+ array[i][0] +"\"> " + array[i][1] + "</a></iframe>"
                document.write(imgiframe);
                document.write("<a href='index.html?illust=" + array[i][0] + "'>このイラストの歌をもっと見る</a></tr></td>")
            }
            document.write("<table width='500'><body text='#000000'><p align='center'>");
            document.write("<tr><td align=left>" + array[i][2] + "</td></tr>");
            document.write("<tr><td align=center>" + array[i][3] + "</td></tr>");
            document.write("<tr><td align=right>" + array[i][4] + "</td></tr></table>");

            document.write("<p><a href='index.html?user=" + array[i][4] + "'>この詠み手の歌をもっと見る</a></p>");
        }
    }
}

function loadFile(){
    var fileData = new XMLHttpRequest();
    var filePath = "./syuenUta.csv";

    fileData.open("get", filePath, false);
    fileData.send(null);

    var lines = fileData.responseText.replace(/""/g,"【ダブルクォート2個】").replace(/"/g,"").replace(/【ダブルクォート2個】/g,'"').split("\n");
    var resultArray = new Array();

    for(var i=0; i<lines.length; i++){
        var tmp = lines[i].split(",");
        if(tmp.length != 1){
            resultArray.push(tmp);
            utaCount = utaCount + 1;
        }
    }
    return resultArray;
}

</script></font>
</p></table></body></html>
