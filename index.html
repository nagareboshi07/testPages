<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
    <link href="https://fonts.googleapis.com/css?family=Noto+Serif+JP:600&display=swap" rel="stylesheet">
<style>
    p{font-family:'Noto Serif JP',serif;}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>東方ニコ楽祭_poem_tukimi</title>
</head>
<font size="5">

<script type="text/javascript">

var urlParam = location.search.substring(1);
 
/*data
ここの配列を追加していく*/
//var array = [["im8799573", "テストタイトル", "ともがらが　居れど流るる　我が涙", "飽くことの無い　思い出の旅", "黒金目鯛"],
//["イラストのID", "イラストのタイトル(いらないかも)", "歌1行目", "歌2行目", "詠み人"]];
var utaCount = 0;
var array = loadFile();

// URLにパラメータが存在する場合
if(urlParam) {
    // 「&」が含まれている場合は「&」で分割
    var param = urlParam.split('&');
 
    // パラメータを格納する用の配列を用意
    var paramArray = [];
    userFlg = 0;
    illustFlg = 0;
    // 用意した配列にパラメータを格納
    for (i = 0; i < param.length; i++) {
        var paramItem = param[i].split('=');
        paramArray[paramItem[0]] = paramItem[1];
        if(paramItem[0]=="user"){
            userFlg = 1;
        }else if(paramItem[0]=="illust"){
            illustFlg = 1;
        }
    }
    
  if(userFlg==1 || illustFlg == 1){
      if(userFlg==1){
          var userName = paramArray.user;
          userName = decodeURI(userName);
          document.write("<p>詠み手指定：" + userName +"</p>");
      }
      if(illustFlg==1){
        document.write("<p>静画ID指定：" + paramArray.illust +"</p>");
      }

    for(i=0; i<utaCount; i++){

        document.write(array[i][4]);

        if((userFlg == 0 || array[i][4] == userName) && (illustFlg == 0 || array[i][0] == paramArray.illust)){
            document.write("<table width=\"800\"><body text=\"#000000\"><p align=\"center\">");
            imgiframe = "<iframe width=\"312\" height=\"176\" src=\"https://ext.seiga.nicovideo.jp/thumb/"+ array[i][0] +"\" scrolling=\"no\" style=\"border:solid 1px #888;\" frameborder=\"0\"><a href=\"https://seiga.nicovideo.jp/seiga/"+ array[i][0] +"\"> " + array[i][1] + "</a></iframe>"
            document.write("<tr><td rowspan=\"4\" width=\"313\">" + imgiframe + "</td>");

            document.write("<td align=left>" + array[i][2] + "</td></tr>");
            document.write("<tr><td align=center>" + array[i][3] + "</td></tr>");
            document.write("<tr><td align=right>" + array[i][4] + "</td></tr>");

            document.write("<tr><td><a href=\"index.html?user=" + array[i][4] + "\">この詠み手の歌をもっと見る</a>　　<a href=\"index.html?illust=" + array[i][0] + "\">このイラストの歌をもっと見る</a></tr></td>");
            document.write("</table>");
        }
    }

  }
}else{


    for(i=0; i<utaCount; i++){
        document.write("<table width=\"800\"><body text=\"#000000\"><p align=\"center\">");
        imgiframe = "<iframe width=\"312\" height=\"176\" src=\"https://ext.seiga.nicovideo.jp/thumb/"+ array[i][0] +"\" scrolling=\"no\" style=\"border:solid 1px #888;\" frameborder=\"0\"><a href=\"https://seiga.nicovideo.jp/seiga/"+ array[i][0] +"\"> " + array[i][1] + "</a></iframe>"
        document.write("<tr><td rowspan=\"4\" width=\"313\">" + imgiframe + "</td>");

        document.write("<td align=left>" + array[i][2] + "</td></tr>");
        document.write("<tr><td align=center>" + array[i][3] + "</td></tr>");
        document.write("<tr><td align=right>" + array[i][4] + "</td></tr>");
        document.write("<tr><td><a href=\"index.html?user=" + array[i][4] + "\">この詠み手の歌をもっと見る</a>　　<a href=\"index.html?illust=" + array[i][0] + "\">このイラストの歌をもっと見る</a></tr></td>");
        document.write("</table>");
    }
}

function loadFile(){
    var syuenFile = document.getElementById("syuenCsv");
    var fileData = new XMLHttpRequest();
    var filePath = "./syuenUta.csv";

    fileData.open("get", filePath, false);
    fileData.send(null);

    var lines = fileData.responseText.replace(/"/g,"").split("\n");
    var resultArray = new Array();

    for(var i=0; i<lines.length; i++){
        var tmp = lines[i].split(",");
        if(tmp.length != 1){
            resultArray.push(tmp);
            utaCount = utaCount + 1;
        }
    }
    return resultArray;
}

</script></font>
</p></table></body></html>
